<!-- Breadcrumb Navigation -->
<nav class="breadcrumb">
  <a href="/">Home</a>
  <span class="breadcrumb-separator">/</span>
  <a href="/admin">Admin</a>
  <span class="breadcrumb-separator">/</span>
  <span class="breadcrumb-current">Users Management</span>
</nav>

<!-- Admin Header -->
<div class="admin-header">
  <div class="admin-header-content">
    <div class="admin-title-section">
      <div class="admin-badge">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 2L3 7V13C3 16.5 6 19 10 19C14 19 17 16.5 17 13V7L10 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M10 10L7 12V8L10 6L13 8V12L10 10Z" fill="currentColor"/>
        </svg>
        Admin Panel
      </div>
      <h1 class="admin-title">User Management</h1>
      <p class="admin-subtitle">Manage user accounts, permissions, and roles</p>
    </div>

    <div class="admin-stats">
      <div class="stat-card">
        <div class="stat-icon stat-icon-primary">
          <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
            <path d="M17 18V16C17 14 15 13 13 13H7C5 13 3 14 3 16V18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <circle cx="10" cy="6" r="4" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value"><%= @users.count %></div>
          <div class="stat-label">Total Users</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-icon-success">
          <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
            <path d="M10 2L3 7V13C3 16.5 6 19 10 19C14 19 17 16.5 17 13V7L10 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value"><%= @users.where(admin: true).count %></div>
          <div class="stat-label">Administrators</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-icon-info">
          <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
            <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="2"/>
            <path d="M10 6V10L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value"><%= @users.where("created_at >= ?", 7.days.ago).count %></div>
          <div class="stat-label">New This Week</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Users Table -->
<div class="admin-content">
  <% if @users.any? %>
    <div class="table-container">
      <table class="data-table admin-table">
        <thead>
          <tr>
            <th class="col-id">#ID</th>
            <th class="col-user">User</th>
            <th class="col-email">Email</th>
            <th class="col-role">Role</th>
            <th class="col-projects">Projects</th>
            <th class="col-joined">Joined</th>
            <th class="col-status">Status</th>
            <th class="col-actions">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @users.each do |user| %>
            <tr class="table-row <%= 'row-current-user' if user.id == current_user.id %>">
              <!-- ID Column -->
              <td class="col-id" data-label="ID">
                <span class="user-id">#<%= user.id %></span>
              </td>

              <!-- User Column -->
              <td class="col-user" data-label="User">
                <div class="user-info">
                  <div class="avatar-md">
                    <%= user.username[0].upcase %>
                  </div>
                  <div class="user-details">
                    <a href="/profile/<%= user.id %>" class="user-name">
                      <%= user.username %>
                      <% if user.id == current_user.id %>
                        <span class="user-tag">You</span>
                      <% end %>
                    </a>
                    <span class="user-handle">@<%= user.username.downcase.gsub(/\s+/, '') %></span>
                  </div>
                </div>
              </td>

              <!-- Email Column -->
              <td class="col-email" data-label="Email">
                <div class="email-wrapper">
                  <svg class="email-icon" width="16" height="16" viewBox="0 0 20 20" fill="none">
                    <rect x="2" y="4" width="16" height="12" rx="2" stroke="currentColor" stroke-width="2"/>
                    <path d="M2 6L10 11L18 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  <span class="email-text"><%= user.email %></span>
                </div>
              </td>

              <!-- Role Column -->
              <td class="col-role" data-label="Role">
                <% if user.admin? %>
                  <span class="role-badge role-admin">
                    <svg width="14" height="14" viewBox="0 0 20 20" fill="none">
                      <path d="M10 2L3 7V13C3 16.5 6 19 10 19C14 19 17 16.5 17 13V7L10 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Administrator
                  </span>
                <% else %>
                  <span class="role-badge role-user">
                    <svg width="14" height="14" viewBox="0 0 20 20" fill="none">
                      <circle cx="10" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                      <path d="M3 18C3 14 6 11 10 11C14 11 17 14 17 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    User
                  </span>
                <% end %>
              </td>

              <!-- Projects Column -->
              <td class="col-projects" data-label="Projects">
                <div class="projects-count">
                  <svg class="projects-icon" width="16" height="16" viewBox="0 0 20 20" fill="none">
                    <rect x="3" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
                    <rect x="11" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
                    <rect x="3" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
                    <rect x="11" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
                  </svg>
                  <% 
                    # Replace with: user.projects.count
                    project_count = rand(0..8) # Demo data
                  %>
                  <span><%= project_count %></span>
                </div>
              </td>

              <!-- Joined Column -->
              <td class="col-joined" data-label="Joined">
                <div class="date-info">
                  <span class="date-primary"><%= user.created_at.strftime("%b %d, %Y") %></span>
                  <span class="date-secondary"><%= time_ago(user.created_at) %></span>
                </div>
              </td>

              <!-- Status Column -->
              <td class="col-status" data-label="Status">
                <span class="status-badge status-active">
                  Active
                </span>
              </td>

              <!-- Actions Column -->
              <td class="col-actions" data-label="Actions">
                <div class="action-buttons">
                  <!-- View Profile -->
                  <a href="/profile/<%= user.id %>" class="btn-action btn-view" title="View Profile">
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                      <path d="M10 3C5 3 1.73 7.11 1 10C1.73 12.89 5 17 10 17C15 17 18.27 12.89 19 10C18.27 7.11 15 3 10 3Z" stroke="currentColor" stroke-width="2"/>
                      <circle cx="10" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
                    </svg>
                  </a>

                  <!-- Admin Controls -->
                  <% if user.admin? %>
                    <!-- Demote from Admin -->
                    <% if user.id != current_user.id %>
                      <form action="/admin/users/<%= user.id %>/demote" method="post" style="display: inline;">
                        <button type="submit" class="btn-action btn-demote" title="Demote from Admin" onclick="return confirm('Remove admin privileges from <%= user.username %>?')">
                          <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                            <path d="M10 14L6 10M10 14L14 10M10 14V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                          </svg>
                        </button>
                      </form>
                    <% else %>
                      <span class="btn-action btn-disabled" title="You cannot demote yourself">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                          <path d="M4 4L16 16M4 16L16 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                      </span>
                    <% end %>
                  <% else %>
                    <!-- Promote to Admin -->
                    <form action="/admin/users/<%= user.id %>/promote" method="post" style="display: inline;">
                      <button type="submit" class="btn-action btn-promote" title="Promote to Admin" onclick="return confirm('Grant admin privileges to <%= user.username %>?')">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                          <path d="M10 14V6M10 6L6 10M10 6L14 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </button>
                    </form>
                  <% end %>

                  <!-- Delete User (Admin only, not self) -->
                  <% if user.id != current_user.id %>
                    <form action="/profile/<%= user.id %>" method="post" style="display: inline;" data-confirm="'Are you sure you want to delete <%= user.username %>? This action cannot be undone.'">
                      <input type="hidden" name="_method" value="DELETE">
                      <button type="submit" class="btn-action btn-delete" title="Delete User" onclick="return ">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                          <path d="M3 5H17M8 5V3H12V5M8 9V15M12 9V15M5 5L6 17H14L15 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                    </form>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="empty-state">
      <div class="empty-icon">ðŸ‘¥</div>
      <h3>No Users Found</h3>
      <p>There are no users in the system yet</p>
    </div>
  <% end %>
</div>