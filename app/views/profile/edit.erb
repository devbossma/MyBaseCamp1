<% if flash[:success] %>
    <div class="flash success"><%= flash[:success] %></div>
<% end %>

<% if flash[:error] %>
    <div class="flash error"><%= flash[:error] %></div>
<% end %>

<div class="form-container">
    <div style="text-align: center; margin-bottom: 2rem;">
        <h1>Edit Profile</h1>
        <p class="subtitle">Update your account information and preferences</p>
    </div>

    <form action="/profile/update" method="POST" class="form">
        <input type="hidden" name="_method" value="PUT">

        <!-- Basic Information Section -->
        <h3 style="margin-bottom: 1.5rem; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem;">
            <span class="card-icon">üë§</span>
            Basic Information
        </h3>

        <!-- Avatar Section -->
        <div class="form-group" style="text-align: center; margin-bottom: 2rem;">
            <div class="avatar-xs" style="width: 80px; height: 80px; border-radius: 16px; margin: 0 auto 1rem; font-size: 1.5rem; background: var(--gradient-primary);">
                <%= @user.username[0].upcase %>
            </div>
            <button type="button" class="btn btn-outline btn-sm">
                <span class="btn-icon">üñºÔ∏è</span>
                Change Avatar
            </button>
        </div>

        <!-- Username -->
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" 
                    id="username" 
                    name="user[username]" 
                    class="form-control" 
                    value="<%= @user.username %>" 
                    required
                    placeholder="Enter your username">
            <small style="color: var(--text-muted); margin-top: 0.25rem; display: block;">
                This will be displayed to other users
            </small>
        </div>

        <!-- Email -->
        <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" 
                    id="email" 
                    name="user[email]" 
                    class="form-control" 
                    value="<%= @user.email %>" 
                    required
                    placeholder="Enter your email address">
            <small style="color: var(--text-muted); margin-top: 0.25rem; display: block;">
                We'll send important notifications to this address
            </small>
        </div>

        <!-- Profile Information Section -->
        <h3 style="margin: 2.5rem 0 1.5rem 0; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem;">
            <span class="card-icon">üìù</span>
            Profile Information
        </h3>

        <!-- Bio -->
        <div class="form-group">
            <label for="bio">Bio</label>
            <textarea id="bio" 
                        name="profile[bio]" 
                        class="form-control" 
                        rows="4"
                        placeholder="Tell us a bit about yourself..."><%= @user.profile.bio %></textarea>
            <small style="color: var(--text-muted); margin-top: 0.25rem; display: block;">
                Maximum 500 characters. <%= @user.profile.bio.to_s.length %>/500
            </small>
        </div>

        <!-- Preferences Section -->
        <h3 style="margin: 2.5rem 0 1.5rem 0; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem;">
            <span class="card-icon">‚öôÔ∏è</span>
            Preferences
        </h3>

        <!-- Notification Preferences -->
        <div class="form-group">
            <label>Notification Preferences</label>
            <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: 0.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" name="profile[email_notifications]" value="true" <%= @user.profile.email_notifications ? 'checked' : '' %>>
                    <span>Receive email notifications</span>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" name="profile[weekly_digest]" value="true" <%= @user.profile.weekly_digest ? 'checked' : '' %>>
                    <span>Send weekly project digest</span>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" name="profile[public_profile]" value="true" <%= @user.profile.public_profile ? 'checked' : '' %>>
                    <span>Make profile public</span>
                </label>
            </div>
        </div>

        <!-- Regional Settings -->
        <div class="form-group">
            <label for="timezone">Timezone</label>
            <select id="timezone" name="profile[timezone]" class="form-control">
                <option value="UTC" <%= @user.profile.timezone == 'UTC' ? 'selected' : '' %>>UTC</option>
                <option value="Eastern Time (US & Canada)" <%= @user.profile.timezone == 'Eastern Time (US & Canada)' ? 'selected' : '' %>>Eastern Time (US & Canada)</option>
                <option value="Pacific Time (US & Canada)" <%= @user.profile.timezone == 'Pacific Time (US & Canada)' ? 'selected' : '' %>>Pacific Time (US & Canada)</option>
                <option value="Central Time (US & Canada)" <%= @user.profile.timezone == 'Central Time (US & Canada)' ? 'selected' : '' %>>Central Time (US & Canada)</option>
                <option value="Europe/Paris" <%= @user.profile.timezone == 'Europe/Paris' ? 'selected' : '' %>>Europe/Paris</option>
                <option value="Europe/London" <%= @user.profile.timezone == 'Europe/London' ? 'selected' : '' %>>Europe/London</option>
                <option value="Asia/Tokyo" <%= @user.profile.timezone == 'Asia/Tokyo' ? 'selected' : '' %>>Asia/Tokyo</option>
            </select>
        </div>

        <div class="form-group">
            <label for="language">Language</label>
            <select id="language" name="profile[language]" class="form-control">
                <option value="en" <%= @user.profile.language == 'en' ? 'selected' : '' %>>English</option>
                <option value="fr" <%= @user.profile.language == 'fr' ? 'selected' : '' %>>French</option>
                <option value="es" <%= @user.profile.language == 'es' ? 'selected' : '' %>>Spanish</option>
                <option value="de" <%= @user.profile.language == 'de' ? 'selected' : '' %>>German</option>
                <option value="it" <%= @user.profile.language == 'it' ? 'selected' : '' %>>Italian</option>
            </select>
        </div>

        <!-- Action Buttons -->
        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
            <button type="submit" class="btn btn-primary btn-block">
                <span class="btn-icon">üíæ</span>
                Save Changes
            </button>
            <a href="/profile" class="btn btn-outline btn-block">
                Cancel
            </a>
        </div>
    </form>

    <!-- Danger Zone -->
    <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border);">
        <h3 style="color: var(--danger); margin-bottom: 1rem;">Danger Zone</h3>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(239, 68, 68, 0.05); border-radius: var(--radius); border: 1px solid rgba(239, 68, 68, 0.2);">
                <div>
                    <strong style="color: var(--text-primary);">Delete Account</strong>
                    <p style="color: var(--text-muted); margin: 0.25rem 0 0 0; font-size: 0.9rem;">
                        Permanently delete your account and all associated data
                    </p>
                </div>
                <form action="/profile/delete" method="POST" style="margin: 0;">
                    <input type="hidden" name="_method" value="DELETE">
                    <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete your account? This action cannot be undone.')">
                        <span class="btn-icon">üóëÔ∏è</span>
                        Delete Account
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>