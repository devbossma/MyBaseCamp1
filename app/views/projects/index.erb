<% if @projects.any? %>
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th class="col-id">#ID</th>
          <th class="col-name">Project Name</th>
          <th class="col-status">Status</th>
          <th class="col-description">Description</th>
          <th class="col-contributors">Contributors</th>
          <th class="col-comments">Comments</th>
          <th class="col-actions">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @projects.each do |project| %>
          <tr class="table-row">
            <!-- ID Column -->
            <td class="col-id" data-label="ID">
              <span class="project-id">#<%= project.id %></span>
            </td>

            <!-- Project Name Column -->
            <td class="col-name" data-label="Project">
              <a href="/projects/<%= project.id %>" class="project-link">
                <%= project.name %>
              </a>
            </td>
            <!-- Project Status Column -->
            <td class="col-status" data-label="Status">
                  <%= project_status_badge(project) %>
            </td>

            <!-- Description Column -->
            <td class="col-description" data-label="Description">
              <p class="description-text">
                <%= project.description.to_s.length > 50 ? project.description.to_s[0..50] + '...' : project.description %>
              </p>
            </td>

            <!-- Contributors Column -->
            <td class="col-contributors" data-label="Contributors">
              <div class="contributors-list">
                <% 
                  contributors = ([project.user] + project.assigned_users.to_a).uniq { |u| u.id }
                  contributors_count = contributors.length
                %>
                
                <div class="avatars-group">
                  <% contributors.take(3).each do |contributor| %>
                    <div class="avatar-sm" title="<%= contributor.username %>">
                      <%= contributor.username[0].upcase %>
                    </div>
                  <% end %>
                  
                  <% if contributors_count > 3 %>
                    <div class="avatar-sm avatar-more">
                      +<%= contributors_count - 3 %>
                    </div>
                  <% end %>
                </div>
                
                <span class="contributors-count">
                  <%= contributors_count %> <%= contributors_count == 1 ? 'contributor' : 'contributors' %>
                </span>
              </div>
            </td>

            <!-- Comments Column -->
            <td class="col-comments" data-label="Comments">
              <div class="comments-info">
                <% 
                  # Example: Replace with actual comments logic
                  # total_comments = project.comments.count
                  # unread_comments = project.comments.where(read: false, user_id: current_user.id).count
                  total_comments = rand(0..15) # Demo data
                  unread_comments = rand(0..5) # Demo data
                %>
                
                <a href="/projects/<%= project.id %>#comments" class="comment-badge <%= unread_comments > 0 ? 'has-unread' : '' %>">
                  <svg class="comment-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M2 10C2 5.58172 5.58172 2 10 2C14.4183 2 18 5.58172 18 10C18 14.4183 14.4183 18 10 18C8.89 18 7.84 17.77 6.88 17.37L3 18L3.63 14.12C3.23 13.16 3 12.11 3 11C3 10.66 3.03 10.33 3.07 10H2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  
                  <span class="comment-count"><%= total_comments %></span>
                  
                  <% if unread_comments > 0 %>
                    <span class="unread-badge"><%= unread_comments %></span>
                  <% end %>
                </a>
              </div>
            </td>

            <!-- Actions Column -->
            <td class="col-actions" data-label="Actions">
              <div class="action-buttons">
                <a href="/projects/<%= project.id %>" class="btn btn-outline btn-sm" title="View Project">
                  <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                    <path d="M10 3C5 3 1.73 7.11 1 10C1.73 12.89 5 17 10 17C15 17 18.27 12.89 19 10C18.27 7.11 15 3 10 3Z" stroke="currentColor" stroke-width="2"/>
                    <circle cx="10" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
                  </svg>
                </a>

                <% if current_user.can_manage?(project) %>
                  <a href="/projects/<%= project.id %>/edit" class="btn btn-ghost btn-sm" title="Edit Project">
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                      <path d="M14.5 2.5C15.33 1.67 16.67 1.67 17.5 2.5C18.33 3.33 18.33 4.67 17.5 5.5L6.5 16.5L2 18L3.5 13.5L14.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </a>
                <% end %>

                <% if current_user.admin? || current_user.owns?(project) %>
                  <form action="/projects/<%= project.id %>" method="post" style="display: inline;">
                    <input type="hidden" name="_method" value="DELETE">
                    <button type="submit" class="btn btn-danger btn-sm" title="Delete Project" onclick="return confirm('Are you sure you want to delete this project?')">
                      <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                        <path d="M3 5H17M8 5V3H12V5M8 9V15M12 9V15M5 5L6 17H14L15 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </form>
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <span class="pagination-info">Showing <%= @projects.count %> project<%= 's' if @projects.count != 1 %></span> 
  </div>
  <span class="create-new-project">
      <a href="/projects/new" class="btn btn-primary">
        <i class="fa-solid fa-circle-plus"></i> New Project
      </a>
  </span>
<% else %>
  <div class="empty-state">
    <h3> <i class="fa-regular fa-folder-open"></i> No Projects Yet</h3>
    <p>Create your first project to get started</p>
    <a href="/projects/new" class="btn btn-primary">
      <span class="btn-icon">+</span> Create Project
    </a>
  </div>
<% end %>